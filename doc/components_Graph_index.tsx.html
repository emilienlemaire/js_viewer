<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>components/Graph/index.tsx - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="global.html#Graph">Graph</a><ul class='methods'><li data-type='method'><a href="global.html#Graph#_getAncestors">_getAncestors</a></li><li data-type='method'><a href="global.html#Graph#_toEdge">_toEdge</a></li><li data-type='method'><a href="global.html#Graph#_toNode">_toNode</a></li><li data-type='method'><a href="global.html#Graph#_toSubsumedEdge">_toSubsumedEdge</a></li><li data-type='method'><a href="global.html#Graph#addGraphLibNode">addGraphLibNode</a></li><li data-type='method'><a href="global.html#Graph#addSubsumedEdge">addSubsumedEdge</a></li><li data-type='method'><a href="global.html#Graph#ancestors">ancestors</a></li><li data-type='method'><a href="global.html#Graph#getEdges">getEdges</a></li><li data-type='method'><a href="global.html#Graph#node">node</a></li><li data-type='method'><a href="global.html#Graph#targetEdges">targetEdges</a></li><li data-type='method'><a href="global.html#Graph#~debounce">debounce</a></li><li data-type='method'><a href="global.html#Graph#~onClose">onClose</a></li><li data-type='method'><a href="global.html#Graph#~onRezie">onRezie</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#checkIndex">checkIndex</a></li><li><a href="global.html#checkShowAllNodes">checkShowAllNodes</a></li><li><a href="global.html#colorToHex">colorToHex</a></li><li><a href="global.html#ContextMenu">ContextMenu</a></li><li><a href="global.html#CrossIcon">CrossIcon</a></li><li><a href="global.html#deleteOptionsInfo">deleteOptionsInfo</a></li><li><a href="global.html#displayNewGraph">displayNewGraph</a></li><li><a href="global.html#dot_str">dot_str</a></li><li><a href="global.html#drawArrow">drawArrow</a></li><li><a href="global.html#drawHover">drawHover</a></li><li><a href="global.html#drawNode">drawNode</a></li><li><a href="global.html#Dropzone">Dropzone</a></li><li><a href="global.html#getD3Hierachy">getD3Hierachy</a></li><li><a href="global.html#getGraphNoSubsumed">getGraphNoSubsumed</a></li><li><a href="global.html#GraphSplit">GraphSplit</a></li><li><a href="global.html#hideContextMenu">hideContextMenu</a></li><li><a href="global.html#initGraph">initGraph</a></li><li><a href="global.html#initialState">initialState</a></li><li><a href="global.html#initNodeGraphics">initNodeGraphics</a></li><li><a href="global.html#initPIXI">initPIXI</a></li><li><a href="global.html#Main">Main</a></li><li><a href="global.html#MoreVerticalIcon">MoreVerticalIcon</a></li><li><a href="global.html#onBackgroundClick">onBackgroundClick</a></li><li><a href="global.html#onHover">onHover</a></li><li><a href="global.html#onNodeClick">onNodeClick</a></li><li><a href="global.html#onOut">onOut</a></li><li><a href="global.html#onTicked">onTicked</a></li><li><a href="global.html#OptionalGraph">OptionalGraph</a></li><li><a href="global.html#setEmptySelection">setEmptySelection</a></li><li><a href="global.html#setGraph">setGraph</a></li><li><a href="global.html#TopAppBar">TopAppBar</a></li><li><a href="global.html#useD3">useD3</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">components/Graph/index.tsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * src/components/Graph/index.tsx
 * Copyright (c) 2021 Emilien Lemaire &lt;emilien.lem@icloud.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import type { Size } from "../../types/Common";

import React, { useEffect, useState } from "react";
import { useSelector, useDispatch } from "react-redux";

import { initGraph } from "../../common/init";

import { dotSelector } from "../../store/dot/dotSlice";
import { setGraph, graphSelector } from "../../store/graph/graphSlice";
import {
  addOptionsInfo,
  optionsSelector,
  resetOptionsInfo,
  deleteOptionsInfo,
} from "../../store/options/optionsSlice";

import GraphSplit from "./GraphSplit";

import "../../css/Grid.css";

//eslint-disable-next-line
// (window as any).__PIXI_INSPECTOR_GLOBAL_HOOK__ &amp;&amp;
  //eslint-disable-next-line
//(window as any).__PIXI_INSPECTOR_GLOBAL_HOOK__.register({ PIXI: PIXI });


/**
 * This component contains the graphslipts and manages their layout.
 *
 * @returns {React.FunctionComponentElement&lt;null>} The component to be displayed according to current
 *  state
 */
export default function Graph(): React.FunctionComponentElement&lt;null> {

  const dispatch = useDispatch();

  const dotState = useSelector(dotSelector);
  const graphState = useSelector(graphSelector);
  const optionsState = useSelector(optionsSelector);

  const [splitsCount, setSplitCount] = useState&lt;number>(0);
  const [splits, setSplits] = useState&lt;JSX.Element[]>([]);
  const [windowSize, setWindowSize] = useState&lt;Size>({
    width: window.innerWidth,
    height: window.innerHeight,
  });

  /**
   * On resize callback.
   */
  const onRezie = () => {
    setWindowSize({
      width: window.innerWidth,
      height: window.innerHeight,
    });
  };

  /**
   * This is debounced callback returned by {@link debounce}.
   * @callback debouncedCallabck
   * @param {Event} event - The event that needs debouncing.
   * @returns {void}
   */
  /**
   * This debounce a function according to the timing between 2 similar events. This allows
   * to avoid calling to often an event handler that does heavy calculation.
   *
   * @param {CallableFunction} func - The function we wish to debounce.
   * @param {number} [timer=1000] - The timeout befaore the function can be called again.
  * @returns {debouncedCallabck} The debounced event handler.
   */
  const debounce = ({ func, timer = 1000 }: { func: CallableFunction; timer?: number; }) => {
    let time: NodeJS.Timeout;
    const f = (event: Event) => {
      if (time) clearTimeout(time);
      timer = setTimeout(func, timer, event);
    };
    return f;
  };

  /**
  * Split close callback
  * @callback onSplitCloseCallback
  * @returns {{payload: number, type: string}} The state action performed.
  */

  /**
   * Split close handler.
   *
   * @param {number} index - The index of the closed split.
   * @returns {onSplitCloseCallback} The event handle for the split of index index.
   */
  const onClose = (index: number) => {
    return () => dispatch(deleteOptionsInfo(index));
  };

  // We don't want to resize before the window resize is, that generates too many rendering, so we
  // debounce the resizing.
  window.addEventListener("resize", debounce({ func: onRezie }));

  // If the .dot file loaded is changed, then we reinitialize all the local state, and global state.
  useEffect(() => {
    if (dotState) {
      const graphInfo = initGraph(dotState);
      setSplitCount(0);
      setSplits([]);
      dispatch(setGraph(graphInfo));
      dispatch(resetOptionsInfo());
      dispatch(addOptionsInfo());
    }
    //eslint-disable-next-line
  }, [dotState]);

  // We add remove splits according tot he size of the options array.
  useEffect(() => {
    setSplitCount(optionsState.length);
  }, [optionsState]);

  // We update the splits according to their size and the number of splits shown.
  useEffect(() => {
    const splits = [];

    for (let split = 0; split  &lt; splitsCount; split ++) {
      splits.push(
        &lt;div className="grid__item" key={split}>
          &lt;GraphSplit
            size={{
              width: windowSize.width / splitsCount,
              height: windowSize.height,
            }}
            index={split}
            onClose={onClose(split)}
          />
        &lt;/div>
      );
    }

    setSplits(splits);
  //eslint-disable-next-line
  }, [windowSize, splitsCount, optionsState.length]);

  return (
    &lt;div className="grid grid--auto-fit" style={{height: "100%"}}>
      {graphState &amp;&amp;
        splits
    }
  &lt;/div>
  );
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Mon Jul 19 2021 17:16:25 GMT+0200 (Central European Summer Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
